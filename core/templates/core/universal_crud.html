<!-- core/templates/core/universal_crud.html -->
{% extends 'core/base.html' %}

{% block content %}
<a href="{% url 'entities_menu' %}" class="back-button">‚Üê –ù–∞–∑–∞–¥</a>

<div class="menu-container">
    <h1 class="menu-title">üóÇÔ∏è –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ï –û–ü–ï–†–ê–¶–ò–ò –° –¢–ê–ë–õ–ò–¶–ê–ú–ò</h1>

    <form method="get" action="{% url 'universal_crud_operation' %}" class="entity-form">
        <div class="form-group">
            <label for="table">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É:</label>
            <select name="table" id="table" required onchange="updateTableInfo()">
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É --</option>
                {% for table in tables %}
                <option value="{{ table.name }}" data-records="{{ table.records }}">
                    {{ table.name }} (–∑–∞–ø–∏—Å–µ–π: {{ table.records }})
                </option>
                {% endfor %}
            </select>
        </div>

        <div id="table-info" style="display: none;">
            <div class="info-box">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–±–ª–∏—Ü–µ:</h3>
                <div id="table-details"></div>
            </div>
        </div>

        <div class="form-group">
            <label for="operation">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é:</label>
            <select name="operation" id="operation" required>
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é --</option>
                <option value="view">üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö</option>
                <option value="add">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</option>
                <option value="delete">‚ùå –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å</option>
                <option value="export">üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</option>
            </select>
        </div>

        <button type="submit" class="btn-submit">–í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</button>
        <div style="margin-top: 20px;">
            <a href="{% url 'table_columns_manage' %}?table={{ table }}"
               class="btn-columns" id="manage-columns-btn" style="display: none;">
                üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∞–º–∏
            </a>
        </div>
    </form>
</div>

<style>
    .info-box {
        background-color: #001100;
        border: 1px solid #00ff00;
        border-radius: 5px;
        padding: 15px;
        margin: 20px 0;
    }

    .info-box h3 {
        color: #00ff00;
        margin-bottom: 10px;
    }

    #table-details {
        color: #00ff00;
        font-size: 14px;
    }
    .btn-columns {
        background-color: #0066ff;
        border: 2px solid #00ff00;
        color: #00ff00;
        padding: 12px 25px;
        text-decoration: none;
        display: inline-block;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        transition: all 0.3s;
    }

    .btn-columns:hover {
        background-color: #00ff00;
        color: #000000;
        box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
    }
</style>

<script>
    function updateTableInfo() {
        const select = document.getElementById('table');
        const infoDiv = document.getElementById('table-info');
        const detailsDiv = document.getElementById('table-details');
        const columnsBtn = document.getElementById('manage-columns-btn');

        if (select.value) {
            const selectedOption = select.options[select.selectedIndex];
            const records = selectedOption.getAttribute('data-records');

            detailsDiv.innerHTML = `
                <p>üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π: <strong>${records}</strong></p>
                <p>üè∑Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã: <strong>${select.value}</strong></p>
            `;
            infoDiv.style.display = 'block';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∞–º–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É
            columnsBtn.style.display = 'inline-block';
            columnsBtn.href = `{% url 'table_columns_manage' %}?table=${select.value}`;
        } else {
            infoDiv.style.display = 'none';
            columnsBtn.style.display = 'none';
        }
    }
</script>
{% endblock %}