<!-- core/templates/core/special_queries.html -->
{% extends 'core/base.html' %}

{% block content %}
<a href="{% url 'home' %}" class="back-button">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</a>

<h1 class="menu-title">–°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï SQL –ó–ê–ü–†–û–°–´</h1>

<form method="post">
    {% csrf_token %}

    <!-- –í—ã–±–æ—Ä –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã -->
    <div class="form-group">
        <label>–í—ã–±–µ—Ä–∏—Ç–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—É—é —Ä–∞–±–æ—Ç—É:</label>
        <select name="lab_type" id="lab_type" required onchange="updateQueryOptions()">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
            <option value="lab5">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 5</option>
            <option value="lab6">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 6</option>
        </select>
    </div>

    <!-- –í—ã–±–æ—Ä —Ç–∞–±–ª–∏—Ü—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –ª–∞–± 5) -->
    <div class="form-group" id="table_select" style="display: none;">
        <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É:</label>
        <select name="table_name" id="table_name" onchange="updateLab5Queries()">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
            <option value="employee">Employee (–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏)</option>
            <option value="excursion">Excursion (–≠–∫—Å–∫—É—Ä—Å–∏–∏)</option>
            <option value="exhibit">Exhibit (–≠–∫—Å–ø–æ–Ω–∞—Ç—ã)</option>
            <option value="space_mission">Space Mission (–ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ –º–∏—Å—Å–∏–∏)</option>
            <option value="exhibition">Exhibition (–í—ã—Å—Ç–∞–≤–∫–∏)</option>
            <option value="visitor">Visitor (–ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏)</option>
        </select>
    </div>

    <!-- –í—ã–±–æ—Ä –∑–∞–ø—Ä–æ—Å–∞ -->
    <div class="form-group" id="query_select" style="display: none;">
        <label>–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å:</label>
        <select name="query_type" id="query_type">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
        </select>
    </div>

    <button type="submit" class="btn-submit" id="submit_btn" style="display: none;">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
</form>

{% if query_result %}
<div style="margin-top: 30px;">
    <h2 style="color: #00ff00; margin-bottom: 20px;">–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:</h2>

    <form method="post" style="margin-bottom: 10px;">
        {% csrf_token %}
        <input type="hidden" name="lab_type" value="{{ lab_type }}">
        <input type="hidden" name="query_type" value="{{ selected_query }}">
        <input type="hidden" name="save_result" value="true">
        <button type="submit" class="btn-submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞</button>
    </form>

    <div style="overflow-x: auto;">
        <table>
            <thead>
                <tr>
                    {% for key in columns %}
                    <th>{{ key }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in query_result %}
                <tr>
                    {% for value in row %}
                    <td>{{ value|default:"-" }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<script>
const lab5Queries = {
    'employee': [
        {value: 'emp_1', text: '–°–ø–∏—Å–æ–∫ –§–ò–û –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π (—Å –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–º)'},
        {value: 'emp_2', text: '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å –¥–æ–ª–∂–Ω–æ—Å—Ç—å—é "–≠–∫—Å–∫—É—Ä—Å–æ–≤–æ–¥"'},
        {value: 'emp_3', text: '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –¥–∞—Ç–µ –Ω–∞–π–º–∞'},
        {value: 'emp_4', text: '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å —Ñ–∞–º–∏–ª–∏–µ–π –Ω–∞ "–ü"'}
    ],
    'excursion': [
        {value: 'exc_1', text: '–ù–∞–∑–≤–∞–Ω–∏—è –∏ –¥–∞—Ç—ã —ç–∫—Å–∫—É—Ä—Å–∏–π (—Å –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–º)'},
        {value: 'exc_2', text: '–≠–∫—Å–∫—É—Ä—Å–∏–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏'},
        {value: 'exc_3', text: '–≠–∫—Å–∫—É—Ä—Å–∏–∏ —Å "–ö–æ—Å–º" –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏'},
        {value: 'exc_4', text: '–≠–∫—Å–∫—É—Ä—Å–∏–∏ —Å —ç–∫—Å–∫—É—Ä—Å–æ–≤–æ–¥–∞–º–∏ (INNER JOIN)'},
        {value: 'exc_5', text: '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏ –∏—Ö —ç–∫—Å–∫—É—Ä—Å–∏–∏ (LEFT JOIN)'},
        {value: 'exc_6', text: '–≠–∫—Å–∫—É—Ä—Å–∏–∏ –∏ –∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (RIGHT JOIN)'},
        {value: 'exc_7', text: '–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏ —ç–∫—Å–∫—É—Ä—Å–∏–∏ (FULL JOIN)'}
    ],
    'exhibit': [
        {value: 'exh_1', text: '–ù–∞–∑–≤–∞–Ω–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —ç–∫—Å–ø–æ–Ω–∞—Ç–æ–≤ (—Å –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–º)'},
        {value: 'exh_2', text: '–≠–∫—Å–ø–æ–Ω–∞—Ç—ã –¥–æ 1970 –≥–æ–¥–∞ –∏–∑ –°–°–°–†'},
        {value: 'exh_3', text: '–≠–∫—Å–ø–æ–Ω–∞—Ç—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è'},
        {value: 'exh_4', text: '–≠–∫—Å–ø–æ–Ω–∞—Ç—ã —Å "–ú–∞–∫–µ—Ç" –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏'},
        {value: 'exh_5', text: '–≠–∫—Å–ø–æ–Ω–∞—Ç—ã —Å –º–∏—Å—Å–∏—è–º–∏ (INNER JOIN)'},
        {value: 'exh_6', text: '–≠–∫—Å–ø–æ–Ω–∞—Ç—ã –∏ –∏—Ö –º–∏—Å—Å–∏–∏ (LEFT JOIN)'},
        {value: 'exh_7', text: '–ú–∏—Å—Å–∏–∏ –∏ –∏—Ö —ç–∫—Å–ø–æ–Ω–∞—Ç—ã (RIGHT JOIN)'},
        {value: 'exh_8', text: '–í—Å–µ —ç–∫—Å–ø–æ–Ω–∞—Ç—ã –∏ –º–∏—Å—Å–∏–∏ (FULL JOIN)'}
    ],
    'space_mission': [
        {value: 'sm_1', text: '–ù–∞–∑–≤–∞–Ω–∏—è –∏ —Å—Ç—Ä–∞–Ω—ã –º–∏—Å—Å–∏–π (—Å –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–º)'},
        {value: 'sm_2', text: '–ú–∏—Å—Å–∏–∏ –º–µ–∂–¥—É 1970 –∏ 2000 –≥–æ–¥–∞–º–∏'},
        {value: 'sm_3', text: '–ú–∏—Å—Å–∏–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —Å—Ç—Ä–∞–Ω–µ'},
        {value: 'sm_4', text: '–ú–∏—Å—Å–∏–∏ —Å —É—á–∞—Å—Ç–∏–µ–º –°–®–ê'}
    ],
    'exhibition': [
        {value: 'exb_1', text: '–ù–∞–∑–≤–∞–Ω–∏—è –∏ —Ç–µ–º—ã –≤—ã—Å—Ç–∞–≤–æ–∫ (—Å –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–º)'},
        {value: 'exb_2', text: '–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤—ã—Å—Ç–∞–≤–∫–∏'},
        {value: 'exb_3', text: '–í—ã—Å—Ç–∞–≤–∫–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –¥–∞—Ç–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è'},
        {value: 'exb_4', text: '–í—ã—Å—Ç–∞–≤–∫–∏ –≤ –∑–∞–ª–∞—Ö'},
        {value: 'exb_5', text: '–í—ã—Å—Ç–∞–≤–∫–∏ –∏ –∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (INNER JOIN)'},
        {value: 'exb_6', text: '–í—ã—Å—Ç–∞–≤–∫–∏ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ (LEFT JOIN)'},
        {value: 'exb_7', text: '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏ –∏—Ö –≤—ã—Å—Ç–∞–≤–∫–∏ (RIGHT JOIN)'},
        {value: 'exb_8', text: '–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏ –≤—ã—Å—Ç–∞–≤–∫–∏ (FULL JOIN)'}
    ],
    'visitor': [
        {value: 'vis_1', text: '–¢–∏–ø –±–∏–ª–µ—Ç–∞, –§–ò–û –∏ –≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ (—Å –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–º)'},
        {value: 'vis_2', text: '–ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ —Å –æ—Ç–∑—ã–≤–∞–º–∏'},
        {value: 'vis_3', text: '–ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è'},
        {value: 'vis_4', text: '–ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ —Å –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –∑–Ω–∞–∫–æ–º –≤ –æ—Ç–∑—ã–≤–µ'},
        {value: 'vis_5', text: '–≠–∫—Å–∫—É—Ä—Å–∏–∏ –∏ –∏—Ö –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ (INNER JOIN)'},
        {value: 'vis_6', text: '–≠–∫—Å–∫—É—Ä—Å–∏–∏ –∏ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ (LEFT JOIN)'},
        {value: 'vis_7', text: '–ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ –∏ –∏—Ö —ç–∫—Å–∫—É—Ä—Å–∏–∏ (RIGHT JOIN)'},
        {value: 'vis_8', text: '–í—Å–µ —ç–∫—Å–∫—É—Ä—Å–∏–∏ –∏ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ (FULL JOIN)'}
    ]
};

const lab6Queries = [
    {value: 'lab6_1', text: '–ó–∞–ø—Ä–æ—Å 1 –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã Employee'},
    {value: 'lab6_2', text: '–ó–∞–ø—Ä–æ—Å 2 –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã Excursion'},
    {value: 'lab6_3', text: '–ó–∞–ø—Ä–æ—Å 3 –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã Exhibit'},
    {value: 'lab6_4', text: '–ó–∞–ø—Ä–æ—Å 4 –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã Space Mission'},
    {value: 'lab6_5', text: '–ó–∞–ø—Ä–æ—Å 5 –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã Exhibition'},
    {value: 'lab6_6', text: '–ó–∞–ø—Ä–æ—Å 6 –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã Visitor'}
];

function updateQueryOptions() {
    const labType = document.getElementById('lab_type').value;
    const tableSelect = document.getElementById('table_select');
    const querySelect = document.getElementById('query_select');
    const submitBtn = document.getElementById('submit_btn');
    const queryTypeSelect = document.getElementById('query_type');

    if (labType === 'lab5') {
        tableSelect.style.display = 'block';
        querySelect.style.display = 'none';
        submitBtn.style.display = 'none';
        document.getElementById('table_name').value = '';
        queryTypeSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>';
    } else if (labType === 'lab6') {
        tableSelect.style.display = 'none';
        querySelect.style.display = 'block';
        submitBtn.style.display = 'block';

        queryTypeSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>';
        lab6Queries.forEach(query => {
            queryTypeSelect.innerHTML += `<option value="${query.value}">${query.text}</option>`;
        });
    } else {
        tableSelect.style.display = 'none';
        querySelect.style.display = 'none';
        submitBtn.style.display = 'none';
    }
}

function updateLab5Queries() {
    const tableName = document.getElementById('table_name').value;
    const querySelect = document.getElementById('query_select');
    const submitBtn = document.getElementById('submit_btn');
    const queryTypeSelect = document.getElementById('query_type');

    if (tableName && lab5Queries[tableName]) {
        querySelect.style.display = 'block';
        submitBtn.style.display = 'block';

        queryTypeSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>';
        lab5Queries[tableName].forEach(query => {
            queryTypeSelect.innerHTML += `<option value="${query.value}">${query.text}</option>`;
        });
    } else {
        querySelect.style.display = 'none';
        submitBtn.style.display = 'none';
    }
}
</script>
{% endblock %}