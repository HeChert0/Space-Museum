<!-- core/templates/core/table_columns_manage.html -->
{% extends 'core/base.html' %}

{% block content %}
<a href="{% url 'universal_crud' %}" class="back-button">‚Üê –ù–∞–∑–∞–¥</a>

<h1 class="menu-title">üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∞–º–∏ —Ç–∞–±–ª–∏—Ü—ã: {{ table_name }}</h1>

<div class="columns-container">
    <div class="current-columns">
        <h2>–¢–µ–∫—É—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏:</h2>
        <table>
            <thead>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–¢–∏–ø</th>
                    <th>Null</th>
                    <th>Default</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for column in columns %}
                <tr>
                    <td>{{ column.name }}</td>
                    <td>{{ column.type }}</td>
                    <td>{{ column.nullable|yesno:"YES,NO" }}</td>
                    <td>{{ column.default|default:"-" }}</td>
                    <td>
                        {% if not column.is_primary %}
                        <form method="post" style="display: inline;"
                              onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É {{ column.name }}? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–π –∫–æ–ª–æ–Ω–∫–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã!')">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="drop_column">
                            <input type="hidden" name="column_name" value="{{ column.name }}">
                            <button type="submit" class="btn-delete">‚ùå</button>
                        </form>
                        {% else %}
                        <span style="color: #ffff00;">Primary Key</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="add-column-section">
        <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É:</h2>
        <form method="post" class="entity-form">
            {% csrf_token %}
            <input type="hidden" name="action" value="add_column">

            <div class="form-group">
                <label for="new_column_name">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏:</label>
                <input type="text" name="new_column_name" required pattern="[a-z_][a-z0-9_]*">
            </div>

            <div class="form-group">
                <label for="new_column_type">–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:</label>
                <select name="new_column_type" required>
                    <option value="INTEGER">INTEGER</option>
                    <option value="BIGINT">BIGINT</option>
                    <option value="VARCHAR(255)">VARCHAR(255)</option>
                    <option value="TEXT">TEXT</option>
                    <option value="DATE">DATE</option>
                    <option value="TIMESTAMP">TIMESTAMP</option>
                    <option value="BOOLEAN">BOOLEAN</option>
                    <option value="DECIMAL(10,2)">DECIMAL(10,2)</option>
                    <option value="FLOAT">FLOAT</option>
                </select>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" name="new_column_nullable" value="1" checked>
                    –†–∞–∑—Ä–µ—à–∏—Ç—å NULL –∑–Ω–∞—á–µ–Ω–∏—è
                </label>
            </div>

            <div class="form-group">
                <label for="new_column_default">–ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:</label>
                <input type="text" name="new_column_default" placeholder="NULL">
            </div>

            <button type="submit" class="btn-submit">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É</button>
        </form>
    </div>
</div>

{% if messages %}
    {% for message in messages %}
        <div class="message-box {{ message.tags }}">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<style>
    .columns-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-top: 30px;
    }

    .current-columns, .add-column-section {
        background-color: #001100;
        border: 2px solid #00ff00;
        border-radius: 10px;
        padding: 20px;
    }

    .current-columns h2, .add-column-section h2 {
        color: #00ff00;
        margin-bottom: 20px;
    }

    .btn-delete {
        background: #ff0000;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 3px;
    }

    .btn-delete:hover {
        background: #cc0000;
    }
</style>
{% endblock %}